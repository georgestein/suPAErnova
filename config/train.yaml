autoencoder: &DEFAULT

  # Directory setup
  fig_dir: '../figures/2021/'
  model_dir: 'tf_models/'
  data_dir: 'data/'
  param_dir: 'params/'
  log_dir: 'logs/'
  
  train_data_file: 'data/train_data_kfold0.npy'
  test_data_file: 'data/test_data_kfold0.npy'
  kfold: 0
  colorlaw_file: 'data/F99_colorlaw.txt'
  out_file_tail: '_minz_0pt02_data_augment_amplitude_maxlightcut_norma_covloss_2stagenew'#_covloss_test'
  #out_file_tail: 'test'
  
  # Outputs
  model_summary: !!bool True
  savefig: !!bool False
  savemodel: !!bool True  
  print_params: !!bool True
  
  # Data dimensionality
  data_dim: 288
  cond_dim: 1 
  n_timestep: 32

  # Model architecture
  encode_dims: [256, 128, 32]
  decode_dims: [32, 128, 256]
  #encode_dims: [64, 32, 16]
  #decode_dims: [16, 32, 64]
  #encode_dims: [8, 16, 8]
  #decode_dims: [8, 8, 1]
  #encode_dims: [16, 8, 4]
  #decode_dims: [4, 8, 16]
  latent_dims: [5]

  #layer_type: 'convolution'
  layer_type: 'dense'

  kernel_size: 11
  stride: 6            # ensure data_dim/stride is an integer 
  
  physical_latent: !!bool True
  colorlaw_preset: !!bool True
  use_amplitude: !!bool True
  normalize_amplitude: !!bool True

  # Loss functions
  loss_fn: 'HUBER' # (MAE or wMAE), (MSE or wMSE), (RMSE or wRMSE), NGLL, HUBER, magnitude
  clip_delta: !!float 10.0
  
  iloss_reconstruction: !!bool True
  iloss_covariance: !!bool True
  iloss_amplitude_parameter: !!bool False
  iloss_amplitude_offset: !!bool False

  lambda_covariance: !!float 50000.
  lambda_colorlaw: !!float 0.0
  lambda_amplitude_parameter: !!float 1000.0
  lambda_amplitude_offset: !!float 1.
  
  # AE Training
  epochs: 2500
  test_every: 100
  seed: 13579
  batch_size: 57 #19 #57

  min_train_redshift: !!float 0.02
  max_train_redshift: !!float 0.1
  max_light_cut: [-5, 5] # don't train on SN without at least 1 spectra within this range [units = days]
  twins_cut: !!bool False           # Cut data that was not used in the Twins analysis (https://arxiv.org/abs/2105.02676)
  
  dropout: !!bool False
  batchnorm: !!bool False
  kernel_regularizer: !!bool True
  train_noise: !!bool True        # resample data within measurement errors
  vary_mask: !!bool True          # mask <mask_vary_frac> of spectra for each SN

  lr: !!float 0.005
  dropout_rate: !!float 0.2
  kernel_regularizer_val: !!float 100.0
  noise_scale: !!float 1.0 
  mask_vary_frac: !!float 0.1

flow:
  <<: *DEFAULT

  nlayers: 12
  nunit: 8

  # Training
  epochs_flow: 500
  seed: 13579
  batch_size: 57

  batchnorm_flow: !!bool False

  lr_flow: !!float 0.001
